/*
* validin
* Elegant form validation
* Copyright (c) 2017 Thom Hines
* Licensed under MIT.
* @author Thom Hines
* https://github.com/thomhines/validin
* @version 0.1.1
*/

function vnValidateInput(e,r){if(has_error=!1,error_message="",options=$this_form.data("vn_options"),clearTimeout(validation_debounce_timeout),e.is(":radio")&&(e=$('input[name="'+e.attr("name")+'"]').last()),e.attr("required")&&!e.getValue())has_error=!0,error_message=options.required_field_error_message;else if(!e.attr("required")&&""==e.val()&&e.attr("validate")&&e.attr("validate").indexOf("match")<0)has_error=!1,error_message="";else if(e.attr("validate"))for(reqs=e.attr("validate").split("|"),x=0;x<reqs.length;x++){if(req_values=reqs[x].split(":"),options.custom_tests&&options.custom_tests[req_values[0]]?validation_exp=options.custom_tests[req_values[0]]:validation_exp=options.validation_tests[req_values[0]],"required"==req_values[0]);else if("regex"==req_values[0]){var a="";regex_array=req_values,regex_array.splice(0,1),regex=regex_array.join(":"),"/"==regex.substr(0,1)&&(regex=regex.substr(1)),regex.lastIndexOf("/")>=regex.length-3&&(a=regex.substr(regex.lastIndexOf("/")+1),regex=regex.substr(0,regex.lastIndexOf("/"))),regex=new RegExp(regex,a),""!=e.val().replace(regex,"")&&(has_error=!0,error_message=validation_exp.error_message)}else"min"==req_values[0]&&(parseFloat(e.val())<parseFloat(req_values[1])||parseFloat(e.val())!=e.val())?(has_error=!0,error_message=validation_exp.error_message.replace("%i",req_values[1])):"max"==req_values[0]&&(parseFloat(e.val())>parseFloat(req_values[1])||parseFloat(e.val())!=e.val())?(has_error=!0,error_message=validation_exp.error_message.replace("%i",req_values[1])):"min_length"==req_values[0]&&e.val().length<req_values[1]?(has_error=!0,error_message=validation_exp.error_message.replace("%i",req_values[1])):"max_length"==req_values[0]&&e.val().length>req_values[1]?(has_error=!0,error_message=validation_exp.error_message.replace("%i",req_values[1])):"match"==req_values[0]&&e.val()!=$(req_values[1]).val()?(has_error=!0,$(req_values[1]).addClass("match_error"),error_message=validation_exp.error_message.replace("%i",req_values[1])):""!=e.val().replace(validation_exp.regex,"")&&(has_error=!0,error_message=validation_exp.error_message);"match"==req_values[0]&&e.val()==$(req_values[1]).val()&&$(req_values[1]).removeClass("match_error")}else has_error=!1,error_message="";return r?(vnAttachMessage(e,error_message),has_error?e.attr("aria-invalid","true").addClass(options.invalid_input_class):e.attr("aria-invalid","false").removeClass(options.invalid_input_class),vnDisableParentForm(e.closest("form"))):validation_debounce_timeout=setTimeout(function(){vnAttachMessage(e,error_message),has_error?e.attr("aria-invalid","true").addClass(options.invalid_input_class):e.attr("aria-invalid","false").removeClass(options.invalid_input_class),vnDisableParentForm(e.closest("form"))},options.feedback_delay),options.onValidateInput&&options.onValidateInput({input:e[0],has_error:error_message.length>0,error_message:error_message}),!has_error}function vnIsFormValid(e){return options=$this_form.data("vn_options"),is_valid=!0,$inputs=e.find(":input"),$inputs.each(function(){0==vnValidateInput(jQuery(this),!0)&&(is_valid=!1)}),is_valid}function vnAttachMessage(e,r){return options=$this_form.data("vn_options"),""==r&&e.next().hasClass("validation_error")?void e.next().fadeOut(400,function(){e.next().remove()}):void(""!=r&&(e.next().hasClass("validation_error")||e.after('<div class="'+options.error_message_class+'"></div>'),options.override_input_margins&&(message_margin_top=parseInt(e.next().css("margin-top")),message_margin_bottom=parseInt(e.next().css("margin-bottom")),input_margin=parseInt(e.css("margin-bottom")),e.next().css("margin-top",-input_margin+5+"px").css("margin-bottom",input_margin-5+"px")),e.next().html()!=r&&e.next().hide().html(r).fadeIn(400)))}function vnDisableParentForm(e){return options=$this_form.data("vn_options"),$button=e.find('button, input[type="submit"]'),e.find(':input[aria-invalid="true"]').length?(setTimeout(function(){vnAttachMessage($button,options.form_error_message)},100),void $button.prop("disabled",!0)):e.find(":input[required]").filter(function(){return!jQuery(this).getValue()}).length?(vnAttachMessage($button,options.required_fields_initial_error_message),void $button.prop("disabled",!0)):(vnAttachMessage($button,""),void $button.prop("disabled",!1))}var validin_default_options={validation_tests:{alpha:{regex:/[a-zA-Z]*/,error_message:"This can only contain only letters"},alpha_num:{regex:/[A-Z0-9]*/i,error_message:"This can only contain letters and numbers"},alpha_space:{regex:/[A-Z ]*/i,error_message:"This can only contain letters"},alpha_dash:{regex:/[A-Z\.\-_]*/i,error_message:"This can only contain letters, underscores and hyphens"},alpha_num_dash:{regex:/[A-Z0-9\.\-_]*/i,error_message:"This can only contain letters, numbers, underscores and hyphens"},number:{regex:/[\d]*/,error_message:"This needs to be a valid whole number"},decimal:{regex:/(\d*\.?\d*)/,error_message:"This needs to be a valid number"},name:{regex:/[A-Z\.\-'\s]*/i,error_message:"This needs to be a valid name"},email:{regex:/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}/i,error_message:"This needs to be a valid email address"},url:{regex:/(https?|ftp):\/\/[^\s\/$.?#].[^\s]*/i,error_message:"This needs to be a valid URL"},phone:{regex:/(?=.*?\d{3}( |-|.)?\d{4})((?:\+?(?:1)(?:\1|\s*?))?(?:(?:\d{3}\s*?)|(?:\((?:\d{3})\)\s*?))\1?(?:\d{3})\1?(?:\d{4})(?:\s*?(?:#|(?:ext\.?))(?:\d{1,5}))?)\b/i,error_message:"This needs to be a valid phone number"},zip:{regex:/\d{5}(?:-?\d{4})?/i,error_message:"This needs to be a valid zip code"},creditcard:{regex:/(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|6(?:011|5[0-9][0-9])[0-9]{12}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|(?:2131|1800|35\d{3})\d{11})/i,error_message:"This needs to be a valid credit card number"},regex:{regex:/.*/i,error_message:"This is not a valid value"},min:{regex:/.*/i,error_message:"This number needs to be at least %i"},max:{regex:/.*/i,error_message:"This number needs to no more than %i"},min_length:{regex:/.*/i,error_message:"This needs to be at least %i characters long"},max_length:{regex:/.*/i,error_message:"This needs to be no more than %i characters long"},match:{regex:/.*/i,error_message:"These values have to match"}},feedback_delay:1500,invalid_input_class:"invalid",error_message_class:"validation_error",form_error_message:"Please fix any errors in the form",required_fields_initial_error_message:"Please fill in all required fields",required_field_error_message:"This field is required",override_input_margins:!0,custom_tests:{},onValidateInput:function(){}};jQuery.fn.validin=function(e){jQuery(this).each(function(){jQuery(this).is("form")?jQuery(this).applyValidation(e):jQuery(this).find("form").applyValidation(e)})},jQuery.fn.applyValidation=function(e){options=jQuery.extend(validin_default_options,e),$this_form=jQuery(this),$this_form.data("vn_options",options),$form_inputs=jQuery(this).find(":input"),$('[validate*="required"]').attr("required",!0),vnDisableParentForm(jQuery(this)),$form_inputs.on("input blur",function(e){"true"==jQuery(this).attr("aria-invalid")||"blur"==e.type?vnValidateInput(jQuery(this),!0):vnValidateInput(jQuery(this),!1)}),jQuery(this).on("submit",function(e){$form=jQuery(this),vnIsFormValid($form)||(e.preventDefault(),e.stopPropagation(),$form.find(':input[aria-invalid="true"]').first().focus())}),$form_inputs.keypress(function(e){$form=jQuery(this).closest("form"),$inputs=$form.find(":input"),13==e.keyCode&&(e.preventDefault(),e.stopPropagation(),vnIsFormValid($form)?$form.submit():$form.find(':input[aria-invalid="true"]').first().focus())})},jQuery.fn.getValue=function(){return!(!this.is(":checkbox")||!this.is(":checked"))||!(this.is(":checkbox")&&!this.is(":checked"))&&(this.is(":radio")&&$('input[name="'+this.attr("name")+'"]').filter(":checked").val()?$('input[name="'+this.attr("name")+'"]').filter(":checked").val():!(this.is(":radio")&&!$('input[name="'+this.attr("name")+'"]').filter(":checked").val())&&(!!this.val()&&this.val()))};var validation_debounce_timeout;